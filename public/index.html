<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>IVR Prototype</title>
  <style>
    body { font-family: sans-serif; display: flex; flex-direction: column; align-items: center; padding: 2rem; }
    #pad { display: grid; grid-template-columns: repeat(3, 60px); grid-gap: 10px; margin-top: 1rem; }
    #pad button { aspect-ratio: 1; font-size: 1.5rem; }
    #status { margin: 1rem 0; }
  </style>
</head>
<body>

  <h1>IVR Prototype</h1>

  <input type="file" id="file" />
  <button id="upload">Upload & Build IVR</button>

  <div id="status"></div>

  <button id="call" style="display:none;">📞 Call now</button>
  <audio id="player" controls></audio>

  <div id="pad" style="display:none;">
    <button>1</button><button>2</button><button>3</button>
    <button>4</button><button>5</button><button>6</button>
    <button>7</button><button>8</button><button>9</button>
    <button>*</button><button>0</button><button>#</button>
  </div>

  <script>
    let tree, current;

    async function upload() {
      const file = document.getElementById('file').files[0];
      if (!file) return alert('Choose an OPML or YAML file first');
      const fd = new FormData(); fd.append('file', file);

      document.getElementById('status').textContent = '⏳ Building IVR...';
      const { id } = await fetch('/upload', { method: 'POST', body: fd }).then(r => r.json());
      tree = await fetch(`/tree/${id}`).then(r => r.json());
      current = tree;
      document.getElementById('status').textContent = '✅ IVR ready';
      document.getElementById('call').style.display = 'inline-block';
    }

    function play(node) {
      document.getElementById('player').src = node.audio;
      current = node;
    }

    document.getElementById('upload').onclick = upload;

    document.getElementById('call').onclick = () => {
      document.getElementById('pad').style.display = 'grid';
      play(tree);
    };

    document.querySelectorAll('#pad button').forEach(btn => {
      btn.onclick = () => {
        const pressed = btn.textContent;
        const next = current.options?.find(o => o.key == pressed);
        if (next) play(next.node);
      };
    });
  </script>

</body>
</html>

